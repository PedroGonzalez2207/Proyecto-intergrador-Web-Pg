<header class="main-header">
  <div class="header-content">
    <span class="brand">Explora portafolios y agenda asesorías</span>
  </div>
</header>

<main class="page-main">
  <div class="layout-3">
    <aside class="perfil-card">
      <ng-container *ngIf="auth.user$ | async as u; else sinUsuario">
        <div class="perfil-info">
          <div class="avatar">
            <div class="initials">
              {{ ((u.displayName || u.email || '?') + '') | slice:0:1 | uppercase }}
            </div>
          </div>

          <h3>{{ u.displayName || 'Usuario' }}</h3>
          <p class="rol">Usuario externo</p>

          <div class="datos">
            <p>{{ u.email }}</p>
          </div>

          <div class="logout-wrapper">
            <button class="btn-logout" (click)="logout()">
              Cerrar sesión
            </button>
          </div>
        </div>
      </ng-container>

      <ng-template #sinUsuario>
        <div class="perfil-info empty">
          <p class="rol">Inicia sesión para ver tu perfil y solicitar asesorías.</p>
        </div>
      </ng-template>
    </aside>

    <section class="main-card">
      <div class="card-header-usuario">
        <div>
          <h1>Programadores disponibles</h1>
          <p class="subtitle">
            Elige un programador, revisa sus portafolios y selecciona uno para agendar una asesoría.
          </p>
        </div>
      </div>

      <div class="separator"></div>

      <ng-container *ngIf="programadores.length; else sinProgramadores">
        <div class="programadores-list">
          <article class="programador-card" *ngFor="let prog of programadores">
            <header class="prog-header">
              <div>
                <h2>{{ prog.nombre }}</h2>
                <p class="prog-meta" *ngIf="prog.especialidad || prog.experiencia">
                  <span *ngIf="prog.especialidad"><strong>Especialidad:</strong> {{ prog.especialidad }}</span>
                  <span *ngIf="prog.experiencia"><strong>Experiencia:</strong> {{ prog.experiencia }}</span>
                </p>
              </div>
            </header>

            <div class="portafolios-group" *ngIf="prog.portafolios && prog.portafolios.length; else sinPortafoliosProg">
              <h3 class="portafolios-title">Portafolios</h3>

              <article class="portafolio" *ngFor="let p of prog.portafolios">
                <div class="info">
                  <h3>{{ p.titulo }}</h3>

                  <p class="meta">
                    <span class="badge" *ngIf="p.especialidad">
                      {{ p.especialidad }}
                    </span>
                    <span class="badge soft" *ngIf="p.experiencia">
                      {{ p.experiencia }}
                    </span>
                  </p>

                  <p class="resumen" *ngIf="p.resumen">{{ p.resumen }}</p>

                  <p class="tecnologias" *ngIf="p.tecnologias">
                    <strong>Tecnologías:</strong> {{ p.tecnologias }}
                  </p>
                </div>

                <div class="acciones">
                  <button type="button" class="btn-small" (click)="verDetalle(p)">
                    Ver detalles
                  </button>
                  <button type="button" class="btn-small primary" (click)="seleccionarPortafolio(p)">
                    Agendar asesoría
                  </button>
                </div>
              </article>
            </div>

            <ng-template #sinPortafoliosProg>
              <p class="empty small">Este programador aún no tiene portafolios registrados.</p>
            </ng-template>
          </article>
        </div>
      </ng-container>

      <ng-template #sinProgramadores>
        <div class="empty-state">
          Todavía no hay programadores con portafolios disponibles.
        </div>
      </ng-template>

      <div class="detalle-portafolio" *ngIf="detalleSeleccionado">
        <h3>Detalle del portafolio</h3>
        <p><strong>Título:</strong> {{ detalleSeleccionado.titulo }}</p>
        <p><strong>Programador:</strong> {{ detalleSeleccionado.programadorNombre }}</p>
        <p *ngIf="detalleSeleccionado.especialidad">
          <strong>Especialidad:</strong> {{ detalleSeleccionado.especialidad }}
        </p>
        <p *ngIf="detalleSeleccionado.experiencia">
          <strong>Experiencia:</strong> {{ detalleSeleccionado.experiencia }}
        </p>
        <p *ngIf="detalleSeleccionado.tecnologias">
          <strong>Tecnologías:</strong> {{ detalleSeleccionado.tecnologias }}
        </p>
      </div>
    </section>

    <aside class="side-card">
      <h2 class="section-title">Agendar asesoría</h2>

      <p class="section-subtitle" *ngIf="!seleccionado">
        Selecciona primero un portafolio de la columna central para solicitar una asesoría.
      </p>

      <form *ngIf="seleccionado" (ngSubmit)="enviarSolicitud()" class="form">
        <div class="field">
          <label>Programador</label>
          <input
            type="text"
            [value]="seleccionado.programadorNombre"
            disabled
          />
        </div>

        <div class="field">
          <label>Portafolio</label>
          <input
            type="text"
            [value]="seleccionado.titulo"
            disabled
          />
        </div>

        <div class="field">
          <label>Fecha</label>
          <input type="date" [(ngModel)]="fecha" name="fecha" required />
        </div>

        <div class="field">
          <label>Hora</label>
          <input type="time" [(ngModel)]="hora" name="hora" required />
        </div>

        <div class="field">
          <label>Comentario (opcional)</label>
          <textarea
            [(ngModel)]="comentario"
            name="comentario"
            rows="3"
            placeholder="Describe brevemente el motivo de la asesoría"
          ></textarea>
        </div>

        <button type="submit" class="btn-primary">Enviar solicitud</button>
      </form>
    </aside>
  </div>
</main>

<footer class="main-footer">
  <div class="footer-content">
    <span>© 2025 Code Stage - UPS</span>
  </div>
</footer>

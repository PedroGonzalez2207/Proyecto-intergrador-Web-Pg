<header class="main-header">
  <div class="header-content">
    <span class="brand">Panel de Administración</span>
  </div>
</header>

<main class="page-main">
  <div class="layout">
    <section class="main-card card">
      <div class="card-header">
        <div>
          <h1>Gestión de asesorías</h1>
          <p class="section-subtitle">
            Registra los horarios de disponibilidad de cada programador.
          </p>
        </div>

        <div class="card-actions" *ngIf="auth.user$ | async">
          <button class="btn-blue" routerLink="/admin/usuarios">
            Usuarios
          </button>
        </div>
      </div>

      <div class="separator"></div>

      <div class="selector-programador">
        <label>
          Programador
          <select
            [(ngModel)]="selectedProgrammer"
            name="programador"
            (ngModelChange)="onProgramadorChange()"
          >
            <option [ngValue]="null">Seleccione un programador</option>

            <ng-container *ngFor="let p of (programadores$ | async)">
              <option *ngIf="p.role === 'Programador'" [ngValue]="p">
                {{ p.displayName || p.email }}
              </option>
            </ng-container>
          </select>
        </label>
      </div>

      <ng-container *ngIf="selectedProgrammer; else noProgrammer">
        <div class="slots-actuales">
          <h2>Horarios registrados</h2>

          <div
            class="slots-list"
            *ngIf="disponibilidad$ | async as slots; else loadingSlots"
          >
            <div class="slot" *ngFor="let s of slots">
              <div class="slot-info">
                <p class="slot-date">
                  {{ s.fecha | date: 'EEEE d/MM/yyyy' }}
                </p>
                <p class="slot-time">
                  {{ s.horaInicio }} — {{ s.horaFin }}
                </p>
              </div>
              <button
                type="button"
                class="btn-small"
                (click)="eliminarDisponibilidad(s)"
              >
                Eliminar
              </button>
            </div>

            <div class="empty-state" *ngIf="slots.length === 0">
              No hay horarios registrados para este programador.
            </div>
          </div>

          <ng-template #loadingSlots>
            <div class="empty-state">
              Cargando horarios…
            </div>
          </ng-template>
        </div>

        <div class="separator"></div>

        <div class="nuevo-slot">
          <h2>Agregar nuevo horario</h2>

          <form (ngSubmit)="guardarDisponibilidad()">
            <div class="form-grid">
              <label>
                Fecha
                <input type="date" [(ngModel)]="fecha" name="fecha" />
              </label>

              <label>
                Hora inicio
                <input
                  type="time"
                  [(ngModel)]="horaInicio"
                  name="horaInicio"
                />
              </label>

              <label>
                Hora fin
                <input type="time" [(ngModel)]="horaFin" name="horaFin" />
              </label>
            </div>

            <div class="form-actions">
              <button type="submit" class="btn-lightblue">
                Guardar horario
              </button>
            </div>
          </form>
        </div>
      </ng-container>

      <ng-template #noProgrammer>
        <div class="empty-state">
          Selecciona un programador para gestionar su disponibilidad.
        </div>
      </ng-template>
    </section>

    <aside class="profile-card">
      <ng-container *ngIf="auth.user$ | async as admin">
        <div class="avatar">
          <img
            *ngIf="admin.photoURL"
            [src]="admin.photoURL"
            alt="Foto de administrador"
          />
          <div class="initials" *ngIf="!admin.photoURL">
            {{ ((admin.displayName || admin.email || '?') + '') | slice: 0:1 |
            uppercase }}
          </div>
        </div>

        <h2>{{ admin.displayName || 'Administrador' }}</h2>
        <p class="email">{{ admin.email }}</p>
        <p class="role">Administrador</p>

        <div class="profile-actions">
          <button class="btn-red" (click)="logout()">
            Cerrar sesión
          </button>
        </div>
      </ng-container>
    </aside>
  </div>
</main>

<footer class="main-footer">
  <div class="footer-content">
    <span>© 2025 Code Stage - UPS</span>
  </div>
</footer>

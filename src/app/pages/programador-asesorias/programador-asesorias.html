<div class="page-wrapper">

  <header class="main-header">
    <div class="header-content">
      <span class="brand">Solicitudes de Asesoría</span>
    </div>

    <p class="desc">
      Administra y responde las solicitudes recibidas por parte de los usuarios.
    </p>

    <div class="header-actions">
      <button class="back-btn" routerLink="/programador/portafolio">
        ← Volver al panel
      </button>
    </div>
  </header>

  <main class="page-main">
    <section class="card">
      <div class="card-header">
        <h2 class="section-title">Asesorías recibidas</h2>
        <p class="section-subtitle">
          Cambia el estado y envía un mensaje de confirmación o justificación al usuario.
        </p>
      </div>

      <div class="separator"></div>

      <p class="empty" *ngIf="loading">Cargando asesorías…</p>

      <p class="empty" *ngIf="!loading && errorMsg">
        {{ errorMsg }}
      </p>

      <p class="empty" *ngIf="!loading && !errorMsg && !asesorias.length">
        No tienes solicitudes en este momento.
      </p>

      <div class="list" *ngIf="!loading && !errorMsg && asesorias.length">
        <article class="item" *ngFor="let a of asesorias">
          <div class="info">
            <header class="item-header">
              <div>
                <h3>{{ a.usuarioNombreUI || 'Usuario' }}</h3>
                <p class="meta">{{ a.fechaUI }} · {{ a.horaUI }}</p>
              </div>

              <span class="estado" [ngClass]="a.estado">
                {{ a.estado | titlecase }}
              </span>
            </header>

            <p class="comentario" *ngIf="a.comentario">"{{ a.comentario }}"</p>

            <p class="respuesta" *ngIf="a.mensajeRespuesta">
              <strong>Último mensaje:</strong> {{ a.mensajeRespuesta }}
            </p>
          </div>

          <div class="acciones">
            <button class="btn-small approve" (click)="abrirDialogo(a, 'Aprobada')">Aprobar</button>
            <button class="btn-small reject"  (click)="abrirDialogo(a, 'Rechazada')">Rechazar</button>
            <button class="btn-small pending" (click)="abrirDialogo(a, 'Pendiente')">Pendiente</button>
          </div>
        </article>
      </div>
    </section>
  </main>

  <footer class="main-footer">
    <div class="footer-content">
      © 2025 Code Stage - UPS
    </div>
  </footer>

  <div class="modal-bg" *ngIf="modalOpen" (click)="cerrarModal()"></div>

  <div class="modal" *ngIf="modalOpen">
    <h2>
      {{ estadoDestino === 'Aprobada' ? 'Aprobar asesoría'
        :estadoDestino === 'Rechazada' ? 'Rechazar asesoría'
        :'Guardar' }}
    </h2>

    <p class="modal-detail"><strong>De:</strong> {{ asesoriaSeleccionada?.usuarioNombreUI }}</p>
    <p class="modal-detail"><strong>Fecha:</strong> {{ asesoriaSeleccionada?.fechaUI }} · {{ asesoriaSeleccionada?.horaUI }}</p>

    <label class="modal-label">
      Mensaje para el usuario
      <textarea rows="4" [(ngModel)]="mensajeRespuesta" name="mensajeRespuesta"></textarea>
    </label>

    <div class="modal-actions">
      <button class="btn-cancel" type="button" (click)="cerrarModal()">Cancelar</button>
      <button class="btn-confirm" type="button" (click)="guardarRespuesta()">Enviar mensaje y actualizar</button>
    </div>
  </div>

</div>

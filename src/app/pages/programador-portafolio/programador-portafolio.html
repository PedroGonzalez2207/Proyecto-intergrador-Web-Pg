<div class="page-wrapper">
  <header class="main-header">
    <div class="header-content">
      <span class="brand">Panel del Programador</span>
    </div>
  </header>

  <main class="page-main">
    <div class="layout">
      <aside class="profile-card">
        <ng-container *ngIf="(auth.user$ | async) as u">
          <div class="avatar">
            <img *ngIf="u.fotoPerfil" [src]="u.fotoPerfil" alt="Foto" />
            <img *ngIf="!u.fotoPerfil && u.photoURL" [src]="u.photoURL" alt="Foto" />
            <div class="initials" *ngIf="!u.fotoPerfil && !u.photoURL">
              {{ ((u.displayName || u.email || '?') + '') | slice:0:1 | uppercase }}
            </div>
          </div>

          <h2>{{ u.displayName || 'Programador' }}</h2>
          <p class="email">{{ u.email }}</p>
          <p class="rol">Programador</p>

          <div class="user-details">
            <p *ngIf="u.especialidad"><strong>Especialidad:</strong> {{ u.especialidad }}</p>
            <p *ngIf="u.descripcion">{{ u.descripcion }}</p>
          </div>

          <div class="social-links" *ngIf="u.redes">
            <a
              *ngIf="u.redes.github"
              [href]="u.redes.github"
              target="_blank"
              class="social-icon github"
              aria-label="GitHub"
              rel="noopener noreferrer"
            >
              GH
            </a>
            <a
              *ngIf="u.redes.linkedin"
              [href]="u.redes.linkedin"
              target="_blank"
              class="social-icon linkedin"
              aria-label="LinkedIn"
              rel="noopener noreferrer"
            >
              in
            </a>
            <a
              *ngIf="u.redes.portfolio"
              [href]="u.redes.portfolio"
              target="_blank"
              class="social-icon portfolio"
              aria-label="Portafolio"
              rel="noopener noreferrer"
            >
              ☰
            </a>
            <a
              *ngIf="u.redes.twitter"
              [href]="u.redes.twitter"
              target="_blank"
              class="social-icon twitter"
              aria-label="Twitter"
              rel="noopener noreferrer"
            >
              X
            </a>
          </div>

          <section class="notifications-panel">
            <h3>Notificaciones</h3>

            <div *ngIf="notificaciones.length > 0" class="notif-counter">
              Tienes {{ notificaciones.length }} notificación(es) nueva(s)
            </div>

            <p class="notifications-empty" *ngIf="notificaciones.length === 0">
              No tienes notificaciones nuevas.
            </p>
          </section>

          <div class="logout-container">
            <button class="btn-red logout-btn" type="button" (click)="logout()">
              Cerrar sesión
            </button>
          </div>
        </ng-container>
      </aside>

      <section class="card">
        <div class="card-header">
          <div>
            <h2 class="section-title">Tus proyectos</h2>
            <p class="section-subtitle">Administra los proyectos que se muestran en tu portafolio.</p>
          </div>

          <div class="card-actions">
            <button type="button" routerLink="/programador/dashboard">Ver dashboard</button>
            <button type="button" routerLink="/programador/asesorias">Ver asesorías</button>
            <button type="button" (click)="abrirModal()">+ Nuevo proyecto</button>
          </div>
        </div>

        <div class="separator"></div>

        <div class="tabs">
          <button
            type="button"
            class="tab-btn"
            [class.active]="filtroCategoria === 'Todos'"
            (click)="cambiarFiltro('Todos')"
          >
            Todos
          </button>
          <button
            type="button"
            class="tab-btn"
            [class.active]="filtroCategoria === 'Academico'"
            (click)="cambiarFiltro('Academico')"
          >
            Académico
          </button>
          <button
            type="button"
            class="tab-btn"
            [class.active]="filtroCategoria === 'Laboral'"
            (click)="cambiarFiltro('Laboral')"
          >
            Laboral
          </button>
        </div>

        <p class="empty" *ngIf="!obtenerProyectosFiltrados().length">
          Aún no registras proyectos en tu portafolio. Empieza creando uno nuevo.
        </p>

        <div class="list" *ngIf="obtenerProyectosFiltrados().length">
          <article class="proyecto" *ngFor="let p of obtenerProyectosFiltrados()">
            <div class="info">
              <h3>{{ p.nombre }}</h3>

              <div class="badges">
                <span class="badge categoria" [ngClass]="p.categoria">
                  {{ p.categoria === 'Academico' ? 'Académico' : 'Laboral' }}
                </span>
                <span class="badge participacion">{{ p.participacion }}</span>
              </div>

              <p class="descripcion">{{ p.descripcion }}</p>

              <p class="tecnologias" *ngIf="p.tecnologias">
                <strong>Tecnologías:</strong> {{ p.tecnologias }}
              </p>

              <div class="links">
                <a *ngIf="p.repoUrl" [href]="p.repoUrl" target="_blank" rel="noopener noreferrer">Repositorio</a>
                <a *ngIf="p.demoUrl" [href]="p.demoUrl" target="_blank" rel="noopener noreferrer">Demo</a>
              </div>
            </div>

            <div class="proyecto-actions">
              <button class="edit-btn" type="button" (click)="abrirModal(p)">Editar</button>
              <button class="delete-btn" type="button" (click)="eliminarProyecto(p.id)">Eliminar</button>
            </div>
          </article>
        </div>
      </section>
    </div>
  </main>

  <footer class="main-footer">
    <div class="footer-content">© 2025 Code Stage - UPS</div>
  </footer>

  <div class="modal-bg" *ngIf="modalOpen" (click)="cerrarModal()"></div>

  <div class="modal" *ngIf="modalOpen">
    <h2>{{ editando ? 'Editar proyecto' : 'Nuevo proyecto' }}</h2>

    <form (ngSubmit)="agregarProyecto(); $event.preventDefault()">
      <label>
        Nombre *
        <input type="text" name="nombre" [(ngModel)]="nuevo.nombre" />
      </label>

      <label>
        Categoría *
        <select name="categoria" [(ngModel)]="nuevo.categoria">
          <option value="Academico">Académico</option>
          <option value="Laboral">Laboral</option>
        </select>
      </label>

      <label>
        Participación *
        <select name="participacion" [(ngModel)]="nuevo.participacion">
          <option value="Frontend">Frontend</option>
          <option value="Backend">Backend</option>
          <option value="BaseDeDatos">Base de Datos</option>
          <option value="Fullstack">Fullstack</option>
        </select>
      </label>

      <label>
        Descripción *
        <textarea rows="3" name="descripcion" [(ngModel)]="nuevo.descripcion"></textarea>
      </label>

      <label>
        Tecnologías
        <input name="tecnologias" [(ngModel)]="nuevo.tecnologias" />
      </label>

      <label>
        Repositorio
        <input name="repoUrl" [(ngModel)]="nuevo.repoUrl" />
      </label>

      <label>
        Demo
        <input name="demoUrl" [(ngModel)]="nuevo.demoUrl" />
      </label>

      <div class="modal-actions">
        <button class="cancel" type="button" (click)="cerrarModal()">Cancelar</button>
        <button class="save" type="submit">Guardar</button>
      </div>
    </form>
  </div>
</div>

<div class="page-wrapper">
  <header class="main-header">
    <h1>Panel del Programador</h1>
    <p class="desc">
      Gestiona tu perfil, tus proyectos y las asesorías que recibes.
    </p>
  </header>

  <div class="layout">
    <aside class="profile-card">
      <ng-container *ngIf="(auth.user$ | async) as u">
        <div class="avatar">
          <img *ngIf="u.photoURL"
              [src]="u.photoURL"
              alt="Foto de perfil">
          <div class="initials" *ngIf="!u.photoURL">
            {{ ((u.displayName || u.email || '?') + '') | slice:0:1 | uppercase }}
          </div>
        </div>

        <h2>{{ u.displayName || 'Programador' }}</h2>
        <p class="email">{{ u.email }}</p>

        <p class="rol">
          Rol: Programador
        </p>

        <p class="hint">
          Aquí luego puedes mostrar tu especialidad, bio y redes
          configuradas desde el Admin.
        </p>
      </ng-container>
    </aside>

    <section class="card">
      <div class="card-header">
        <div>
          <h2 class="section-title">Tus proyectos</h2>
          <p class="section-subtitle">
            Administra los proyectos que se muestran en tu portafolio.
          </p>
        </div>

        <div class="card-actions">
          <button routerLink="/programador/asesorias">Ver asesorías</button>
          <button (click)="abrirModal()">+ Nuevo proyecto</button>
          <button class="logout" (click)="logout()">Cerrar sesión</button>
        </div>
      </div>

      <p class="empty" *ngIf="!proyectos.length">
        Aún no registras proyectos en tu portafolio. Empieza creando uno nuevo.
      </p>

      <div class="list" *ngIf="proyectos.length">
        <article class="proyecto" *ngFor="let p of proyectos">
          <div class="info">
            <h3>{{ p.nombre }}</h3>

            <div class="badges">
              <span class="badge categoria" [ngClass]="p.categoria">
                {{ p.categoria === 'Academico' ? 'Académico' : 'Laboral' }}
              </span>
              <span class="badge participacion">
                {{ p.participacion }}
              </span>
            </div>

            <p class="descripcion">{{ p.descripcion }}</p>

            <p class="tecnologias" *ngIf="p.tecnologias">
              <strong>Tecnologías:</strong> {{ p.tecnologias }}
            </p>

            <div class="links">
              <a *ngIf="p.repoUrl" [href]="p.repoUrl" target="_blank">Repositorio</a>
              <a *ngIf="p.demoUrl" [href]="p.demoUrl" target="_blank">Demo</a>
            </div>
          </div>

          <button class="delete-btn" (click)="eliminarProyecto(p.id)">
            Eliminar
          </button>
        </article>
      </div>
    </section>
  </div>

  <div class="modal-bg" *ngIf="modalOpen" (click)="cerrarModal()"></div>

  <div class="modal" *ngIf="modalOpen">
    <h2>Nuevo proyecto</h2>

    <form (ngSubmit)="agregarProyecto()">
      <label>
        Nombre *
        <input type="text" [(ngModel)]="nuevo.nombre" name="nombre">
      </label>

      <label>
        Categoría *
        <select [(ngModel)]="nuevo.categoria" name="categoria">
          <option value="Academico">Académico</option>
          <option value="Laboral">Laboral</option>
        </select>
      </label>

      <label>
        Participación *
        <select [(ngModel)]="nuevo.participacion" name="participacion">
          <option value="Frontend">Frontend</option>
          <option value="Backend">Backend</option>
          <option value="BaseDeDatos">Base de Datos</option>
          <option value="Fullstack">Fullstack</option>
        </select>
      </label>

      <label>
        Descripción *
        <textarea rows="3" [(ngModel)]="nuevo.descripcion" name="descripcion"></textarea>
      </label>

      <label>
        Tecnologías
        <input type="text" [(ngModel)]="nuevo.tecnologias" name="tecnologias">
      </label>

      <label>
        Repositorio
        <input type="text" [(ngModel)]="nuevo.repoUrl" name="repoUrl">
      </label>

      <label>
        Demo
        <input type="text" [(ngModel)]="nuevo.demoUrl" name="demoUrl">
      </label>

      <div class="modal-actions">
        <button type="button" class="cancel" (click)="cerrarModal()">Cancelar</button>
        <button type="submit" class="save">Guardar</button>
      </div>
    </form>
  </div>
</div>
